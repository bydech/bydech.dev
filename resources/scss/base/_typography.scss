// ------------------------------------------------------
// TYPOGRAPHY SYSTEM â€“ bydech.dev
// ------------------------------------------------------

// 1. Dependency Imports
@use "sass:math";
@use "../abstracts/vars" as vars;

// ------------------------------------------------------
// 0. Utilities & Config
// ------------------------------------------------------

// Helper: Strip units (rem/px) to get raw numbers for calculation
@function strip-unit($value) {
  @return math.div($value, ($value * 0 + 1));
}

// Helper: Convert to pixels if value is rem (assumes 16px base)
@function to-px-val($value) {
  @if unit($value) == "rem" {
    @return strip-unit($value) * 16;
  }
  @return strip-unit($value);
}

// CLAMP CALC FUNCTION
// Now supports REM inputs for widths (from your variables)
// Default Min Width: 20rem (320px) - Standard mobile start
// Default Max Width: $bp-xl (80rem/1280px) - Your largest breakpoint
@function clamp-calc($min-size, $max-size, $min-width: 20rem, $max-width: vars.$bp-xl) {
  // 1. Normalize widths to unitless pixels for slope calculation
  $min-w-px: to-px-val($min-width);
  $max-w-px: to-px-val($max-width);

  // 2. Calculate Slope
  $slope: ($max-size - $min-size) / ($max-w-px - $min-w-px);

  // 3. Calculate Y-Axis Intersection
  $y-axis: -1 * $min-w-px * $slope + $min-size;

  // 4. Convert specific values to rem for output
  $min-rem: math.div($min-size, 16) * 1rem;
  $max-rem: math.div($max-size, 16) * 1rem;
  $y-rem: math.div($y-axis, 16) * 1rem;

  // 5. Calculate VW slope
  $slope-vw: $slope * 100vw;

  @return clamp(#{$min-rem}, #{$y-rem} + #{$slope-vw}, #{$max-rem});
}

@function to-rem($px) {
  @return math.div($px, 16) * 1rem;
}

// ------------------------------------------------------
// 1. Font Families
// ------------------------------------------------------
$font-sans:
  "IBMPlex Sans",
  system-ui,
  -apple-system,
  sans-serif;
$font-mono: "JetBrains Mono", "Roboto Mono", monospace;

// ------------------------------------------------------
// 2. Mixins
// ------------------------------------------------------

@mixin type-sans($size, $line, $weight: 400, $tracking: 0) {
  font-family: $font-sans;
  font-size: $size;
  line-height: $line;
  font-weight: $weight;
  letter-spacing: $tracking;
}

@mixin type-mono($size, $line, $weight: 500) {
  font-family: $font-mono;
  font-size: $size;
  line-height: $line;
  font-weight: $weight;
  font-variant-numeric: tabular-nums;
}

// ------------------------------------------------------
// 3. Abstract Styles (Placeholders)
// ------------------------------------------------------
// We use %placeholders so we can extend them without bloating CSS

// Display: Scales from 40px to 64px
// Stops scaling at your $bp-xl (1280px)
%heading-display {
  @include type-mono(clamp-calc(40, 64), 1.1, 600, -0.02em);
}

// H1: Scales from 32px to 48px
%heading-h1 {
  @include type-mono(clamp-calc(32, 48), 1.1, 600, -0.01em);
}

// H2: Scales from 28px to 36px
%heading-h2 {
  @include type-mono(clamp-calc(28, 36), 1.2, 600, 0);
}

// H3: Scales from 24px to 28px
%heading-h3 {
  @include type-mono(clamp-calc(24, 28), 1.3, 500, 0);
}

// H4: Static or subtle scale
%heading-h4 {
  @include type-mono(to-rem(20), 1.4, 500, 0);
}

// Body Text
%body-default {
  @include type-sans(clamp-calc(18, 16), 1.6, 400, 0);
}
%body-small {
  @include type-sans(clamp-calc(16, 14), 1.5, 400, 0);
}

// Mono text
%eyebrow {
  @include type-mono(to-rem(14), 1, 400, 0);
}

// ------------------------------------------------------
// 4. Classes (For use in HTML)
// ------------------------------------------------------

.heading--display {
  @extend %heading-display;
}
.heading--h1 {
  @extend %heading-h1;
}
.heading--h2 {
  @extend %heading-h2;
}
.heading--h3 {
  @extend %heading-h3;
}
.heading--h4 {
  @extend %heading-h4;
}

.body-default {
  @extend %body-default;
}
.body-small {
  @extend %body-small;
}

.eyebrow {
  @extend %eyebrow;
}

// ------------------------------------------------------
// 5. Global Resets (Attaching to Tags)
// ------------------------------------------------------

h1,
h2,
h3,
h4,
h5,
h6,
p,
ul,
ol,
dl,
figure,
blockquote {
  margin: 0;
}

h1 {
  @extend %heading-h1;

  color: var(--text-primary);
}
h2 {
  @extend %heading-h2;
  color: var(--text-primary);
}
h3 {
  @extend %heading-h3;
  color: var(--text-primary);
}
h4 {
  @extend %heading-h4;
  color: var(--text-primary);
}

p {
  @extend %body-default;
  color: var(--text-secondary);
  max-width: 65ch;
}

small {
  @extend %body-small;
  color: var(--text-secondary);
}

// ------------------------------------------------------
// 6. Spacing Utilities
// ------------------------------------------------------

.flow > * + * {
  margin-top: var(--flow-space, 1.5em);
}

.flow--tight {
  --flow-space: 0.75em;
}
.flow--loose {
  --flow-space: 3em;
}

.mb-1 {
  margin-bottom: 0.5rem;
}
.mb-2 {
  margin-bottom: 1rem;
}
.mb-4 {
  margin-bottom: 2rem;
}
.mb-8 {
  margin-bottom: 4rem;
}
